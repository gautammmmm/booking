go mod init booking-backend

go get github.com/gin-gonic/gin
go get github.com/lib/pq
go get golang.org/x/crypto/bcrypt
go get github.com/dgrijalva/jwt-go

Verify the go.mod File
After running the commands, your go.mod file in the backend directory should look something like this:

go
module booking-backend

go 1.21.0 // Your Go version might be different

require (
    github.com/dgrijalva/jwt-go v3.2.0+incompatible
    github.com/gin-gonic/gin v1.9.1
    github.com/lib/pq v1.10.9
    golang.org/x/crypto v0.14.0
)

create user queue_app with password 'queue_app';
create database queue_app;
grant all privileges on database queue_app to queue_app; 

\c queue_app;

-- 3. Connect to the new database
\c queue_app;

-- 4. Create the 'businesses' table
CREATE TABLE businesses (
    id SERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    created_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

-- 5. Create the 'users' table
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    email VARCHAR(255) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    full_name VARCHAR(255) NOT NULL,
    role VARCHAR(50) NOT NULL CHECK (role IN ('super_admin', 'business_admin', 'staff', 'customer')),
    business_id INTEGER REFERENCES businesses(id) ON DELETE CASCADE,
    created_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

-- 2. Create the 'services' table
CREATE TABLE services (
    id SERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL,         -- e.g., "Haircut", "Consultation"
    description TEXT,                   -- Optional description
    duration INTEGER NOT NULL,          -- Length in minutes (e.g., 30, 60)
    business_id INTEGER NOT NULL REFERENCES businesses(id) ON DELETE CASCADE,
    created_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

-- 3. Create the 'appointment_slots' table
CREATE TABLE appointment_slots (
    id SERIAL PRIMARY KEY,
    start_time TIMESTAMPTZ NOT NULL,    -- e.g., '2023-10-27 14:00:00'
    end_time TIMESTAMPTZ NOT NULL,      -- e.g., '2023-10-27 14:30:00'
    is_available BOOLEAN NOT NULL DEFAULT TRUE,
    service_id INTEGER NOT NULL REFERENCES services(id) ON DELETE CASCADE,
    business_id INTEGER NOT NULL REFERENCES businesses(id) ON DELETE CASCADE,
    created_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

-- 4. Create the 'bookings' table (This is the core of the app!)
CREATE TABLE bookings (
    id SERIAL PRIMARY KEY,
    customer_id INTEGER NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    slot_id INTEGER NOT NULL REFERENCES appointment_slots(id) ON DELETE CASCADE,
    status VARCHAR(50) NOT NULL DEFAULT 'scheduled' CHECK (status IN ('scheduled', 'completed', 'cancelled', 'no-show')),
    notes TEXT,                         -- Any notes from the customer
    business_id INTEGER NOT NULL REFERENCES businesses(id


-- 6. (CRITICAL) Create your first Super Admin user manually.
-- Use an online BCrypt generator to hash a password like "admin123".
-- https://bcrypt-generator.com/
INSERT INTO users (email, password_hash, full_name, role, business_id)
VALUES (
    'admin@example.com',
    '$2a$12$Y4CVR/3B6d6oVREAzLgC2.FloWfej6YW/6L.cRzV4JfTg7rnnzJmW', -- This is the hash for "admin123"
    'Super Admin',
    'super_admin',
    NULL
);

 let's create the main.go file. inside backend directory
 
 type nul > main.go
 

package main

import (
	"fmt"
	"log"
	"net/http"
	"booking-backend/database" // Import your database package
	"github.com/gin-gonic/gin"
)

func main() {
	// Connect to the database
	database.ConnectDB()
	defer database.DB.Close() // Close the connection when the program stops

	router := gin.Default()

	router.GET("/api/health", func(c *gin.Context) {
		// Test the database connection within the route
		err := database.DB.Ping()
		if err != nil {
			c.JSON(http.StatusInternalServerError, gin.H{"error": "Database is down"})
			return
		}
		c.JSON(http.StatusOK, gin.H{
			"message": "Server and database are running!",
		})
	})

	fmt.Println("Server starting on http://localhost:8080")
	err := router.Run(":8080")
	if err != nil {
		log.Fatal("Error starting server:", err)
	}
}

Create the database folder and database.go file

Copy and paste the following code into database/database.go:


package database

import (
	"database/sql"
	"fmt"
	"log"
	_ "github.com/lib/pq" // PostgreSQL driver
)

// Global variable for the database connection
var DB *sql.DB

// Connect to the PostgreSQL database
func ConnectDB() {
	connectionString := "user=queue_app dbname=queue_app password=queue_app sslmode=disable"
	var err error
	DB, err = sql.Open("postgres", connectionString)
	if err != nil {
		log.Fatal("Failed to connect to database:", err)
	}

	// Check if the connection is actually working
	err = DB.Ping()
	if err != nil {
		log.Fatal("Failed to ping database:", err)
	}

	fmt.Println("Successfully connected to the database!")
}

go run main.go

